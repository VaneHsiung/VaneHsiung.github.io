<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>vBlog</title>
  
  <subtitle>Vane Hsiung&#39;s Blog</subtitle>
  <link href="https://vanehsiung.github.io/atom.xml" rel="self"/>
  
  <link href="https://vanehsiung.github.io/"/>
  <updated>2020-11-30T14:08:31.380Z</updated>
  <id>https://vanehsiung.github.io/</id>
  
  <author>
    <name>vane</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>FreeBSD Desktop</title>
    <link href="https://vanehsiung.github.io/2020/11/28/FreeBSD-Desktop/"/>
    <id>https://vanehsiung.github.io/2020/11/28/FreeBSD-Desktop/</id>
    <published>2020-11-28T08:38:58.000Z</published>
    <updated>2020-11-30T14:08:31.380Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>The FreeBSD Desktop series are about creating efficient desktop environment on the FreeBSD system.</p><a id="more"></a><h3 id="Simplified-Boot"><a href="#Simplified-Boot" class="headerlink" title="Simplified Boot"></a>Simplified Boot</h3><p>The default FreeBSD boot process is quite verbose with a lot of debugging information along with kernel messages.</p><p>This verbose information is usually useful for servers but not that much for laptops and/or desktop/workstation systems. The UNIX philosophy is to not ‘say’ anything to stdout if everything is OK, so stdout/stderr should only be used when something is wrong.</p><p>Rules: prompt in less then 10 lines</p><ul><li><p>First add the <code>boot_mute=YES</code> option to the <code>/boot/loader.conf</code> file. As we are here, You may as well add <code>autoboot_delay=2</code> parameter to the <code>/boot/loader.conf</code> file to speed up boot process by 8 seconds. Default delay is 10 seconds.</p></li><li><p>In most cases its just adding <code>1&gt; /dev/null</code> or <code>1&gt; /dev/null 2&gt; /dev/null</code> to not display unneeded information at boot process.</p><ul><li><p><code>/etc/rc.d/ldconfig</code></p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">-check_startmsgs &amp;&amp; echo &#x27;ELF ldconfig path:&#x27; $&#123;_LDC&#125;</span></span><br><span class="line"><span class="addition">+check_startmsgs &amp;&amp; echo &#x27;ELF ldconfig path:&#x27; $&#123;_LDC&#125; 1&gt; /dev/null</span></span><br><span class="line"><span class="deletion">-echo &#x27;32-bit compatibility ldconfig path:&#x27; $&#123;_LDC&#125;</span></span><br><span class="line"><span class="addition">+echo &#x27;32-bit compatibility ldconfig path:&#x27; $&#123;_LDC&#125; 1&gt; /dev/null</span></span><br></pre></td></tr></table></figure></li><li><p><code>/etc/rc.d/netif</code></p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">-/sbin/ifconfig $&#123;ifn&#125;</span></span><br><span class="line"><span class="addition">+/sbin/ifconfig $&#123;ifn&#125; 1&gt; /dev/null 2&gt; /dev/null</span></span><br></pre></td></tr></table></figure></li><li><p><code>/etc/rc.d/nfsclient</code></p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">-rpc.umntall -k</span></span><br><span class="line"><span class="addition">+rpc.umntall -k 2&gt; /dev/null</span></span><br></pre></td></tr></table></figure></li><li><p><code>/etc/rc.d/random</code></p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">-       if [ $&#123;harvest_mask&#125; -gt 0 ]; then</span></span><br><span class="line"><span class="deletion">-               echo -n &#x27;Setting up harvesting: &#x27;</span></span><br><span class="line"><span class="deletion">-               $&#123;SYSCTL&#125; kern.random.harvest.mask=$&#123;harvest_mask&#125; &gt; /dev/null</span></span><br><span class="line"><span class="deletion">-               $&#123;SYSCTL_N&#125; kern.random.harvest.mask_symbolic</span></span><br><span class="line"><span class="deletion">-       fi</span></span><br><span class="line"><span class="addition">+       #if [ $&#123;harvest_mask&#125; -gt 0 ]; then</span></span><br><span class="line"><span class="addition">+       #      echo -n &#x27;Setting up harvesting: &#x27;</span></span><br><span class="line"><span class="addition">+       #      $&#123;SYSCTL&#125; kern.random.harvest.mask=$&#123;harvest_mask&#125; &gt; /dev/null</span></span><br><span class="line"><span class="addition">+       #      $&#123;SYSCTL_N&#125; kern.random.harvest.mask_symbolic</span></span><br><span class="line"><span class="addition">+       #fi</span></span><br></pre></td></tr></table></figure></li><li><p><code>/etc/rc.d/routing</code></p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">-eval static_$&#123;_a&#125; delete $_if</span></span><br><span class="line"><span class="addition">+eval static_$&#123;_a&#125; delete $_if 1&gt; /dev/null 2&gt; /dev/null</span></span><br><span class="line"><span class="deletion">-static_$2 add $3</span></span><br><span class="line"><span class="addition">+static_$2 add $3 1&gt; /dev/null 2&gt; /dev/null</span></span><br><span class="line"><span class="deletion">-static_$2 add $3</span></span><br><span class="line"><span class="addition">+static_$2 add $3 1&gt; /dev/null 2&gt; /dev/null</span></span><br></pre></td></tr></table></figure></li><li><p><code>/etc/rc.d/devmatch</code></p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">-echo &quot;Autoloading module: $&#123;m&#125;&quot;</span></span><br><span class="line"><span class="addition">+#echo &quot;Autoloading module: $&#123;m&#125;&quot;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>I prefer not to use a login manager so I have an alias named <code>x</code> to <code>xinit</code> command. This way after I login I type <code>x</code> press [ENTER] and x11 desktop is started.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x: aliased to xinit ~&#x2F;.xinitrc -- -dpi 75 -nolisten tcp 1&gt; &#x2F;dev&#x2F;null 2&gt; &#x2F;dev&#x2F;null</span><br></pre></td></tr></table></figure></li><li><p>we can silence the FreeBSD boot process even more. Just add <code>rc_startmsgs=&quot;NO&quot;</code> to your <code>/etc/rc.conf</code> file.</p></li></ul><h5 id="Reply"><a href="#Reply" class="headerlink" title="Reply"></a>Reply</h5><p>For troubleshooting issues, Most boot messages can be found under:</p><ul><li>dmesg</li><li>(cat|tail|grep|less|more..) /var/log/messages</li></ul><p>Also don’t really need it printing the default routes, netstat -r works great.</p><p>Tmux is useful.</p><p>(dislike)To disable the boot menu, put the following line in <code>/boot/loader.conf</code>: <code>beastie_disable=&quot;YES&quot;</code></p><h3 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h3><h5 id="BIOS"><a href="#BIOS" class="headerlink" title="BIOS"></a>BIOS</h5><p>Disable unused (Express Card/Bluetooth/Camera/Fingerprint Reader/…) and unwanted options (Intel AMT/Security Chip/UEFI/…).</p><h5 id="Install-1"><a href="#Install-1" class="headerlink" title="Install"></a>Install</h5><ul><li><p>To put the image on the pendrive we will use the dd tool available on almost any Mac OS X (macOS) and Linux system. For Windows You will have to download it from here – <span class="exturl" data-url="aHR0cDovL3d3dy5jaHJ5c29jb21lLm5ldC9kZA==">dd for windows<i class="fa fa-external-link-alt"></i></span>( bs=1M on Linux/Windows ).</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dd if&#x3D;FreeBSD-11.1-RELEASE-amd64-memstick.img of&#x3D;&#x2F;dev&#x2F;da1 bs&#x3D;1m</span><br></pre></td></tr></table></figure></li><li><p>When we have a new machine there is always a problem with new name for it. The RFC 1178 <span class="exturl" data-url="aHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzExNzg=">Choosing a Name for Your Computer<i class="fa fa-external-link-alt"></i></span> from 1990 year tries to address that issue </p></li><li><p>We do not need any additional components, with all deselected as shown below only the (not shown) base and kernel will be installed.</p></li></ul><img data-src="/2020/11/28/FreeBSD-Desktop/freebsd-11-1-laptop-install-04.png" class="" title="FreeBSD"><ul><li>We will use ZFS because we want to use Boot Environments with sysutils/beadm port.<ul><li>Hit [ENTER] on the <code>Pool Type/Disks</code> to select target disk to install FreeBSD on.</li><li>Now (in FreeBSD 12.x) it is possible to install FreeBSD on GELI encrypted root on ZFS pool without any additional partitions or filesystems. You need to select is <code>Yes</code> for the <code>Encryption</code> part .</li><li>I advice using <code>GPT (BIOS+UEFI)</code> as it will support both system types so when you are running BIOS system now and will move the disk to other system that boots with UEFI it will also just work out of the box.</li><li>We will set SWAP size to <code>0</code> (no SWAP) as it will not be needed. If we will need SWAP in the future, then we will create ZVOL on ZFS and use it as a SWAP device.</li></ul></li></ul><img data-src="/2020/11/28/FreeBSD-Desktop/freebsd-install-03.png" class="" title="FreeBSD"><ul><li>Select services as shown below.</li></ul><img data-src="/2020/11/28/FreeBSD-Desktop/freebsd-11-1-laptop-install-23.png" class="" title="FreeBSD"><ul><li>Enable all security hardening features as shown below.</li></ul><img data-src="/2020/11/28/FreeBSD-Desktop/freebsd-11-1-laptop-install-24.png" class="" title="FreeBSD"><h5 id="Boot"><a href="#Boot" class="headerlink" title="Boot"></a>Boot</h5><p>If You will have attached LAN cable and your interface is <code>em0</code> (check <code>ifconfig</code> command output) then <code>dhclient em0</code> command should grant You the working connection to the Internet – assuming that You have DHCP server on that network. </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ifconfig em0 up</span><br><span class="line"># dhclient em0</span><br></pre></td></tr></table></figure><p>To test the network connectivity use the <code>ping</code> command.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># ping -c 3 freebsd.org</span><br></pre></td></tr></table></figure><p>If You would like to connect to the World with wireless connection then here are the needed commands. First lets check what wireless card You have.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># sysctl net.wlan.devices</span><br></pre></td></tr></table></figure><p>We will now create <code>wlan</code> virtual device on top of our <code>iwn0</code> device and bring it up.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ifconfig wlan0 create wlandev iwn0</span><br><span class="line"># ifconfig wlan0 up</span><br></pre></td></tr></table></figure><p>We can scan for existing nearby WiFi access points if needed.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># ifconfig wlan0 scan</span><br></pre></td></tr></table></figure><p>Now we need to add the desired WiFi network to the /etc/wpa_supplicant.conf file as shown below.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">network&#x3D;&#123;</span><br><span class="line">  ssid&#x3D;&quot;WIFI-NETWORK-NAME&quot;</span><br><span class="line">  psk&#x3D;&quot;PASSWORD&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Then You may connect to it using the <code>wpa_supplicant</code> daemon. Hit the <code>[CTRL]+[Z]</code> key combination to put the process into suspended state. Then we type the <code>bg</code> command to put it back into running state, but in the background so we can continue to type next commands.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># wpa_supplicant -i wlan0 -c &#x2F;etc&#x2F;wpa_supplicant.conf</span><br></pre></td></tr></table></figure><p>Now we will request for the IP address from the access point DHCP server.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># dhclient wlan0</span><br></pre></td></tr></table></figure><h3 id="X11-Window-System"><a href="#X11-Window-System" class="headerlink" title="X11 Window System"></a>X11 Window System</h3><h5 id="BIOS-or-UEFI"><a href="#BIOS-or-UEFI" class="headerlink" title="BIOS or UEFI"></a>BIOS or UEFI</h5><p>First things first, if You find a device that is not supported by any ‘accelerated’ driver like <code>intel</code> or <code>nvidia</code>. You would use <code>vesa</code> driver (Video Electronics Standards Association) while booting in BIOS mode and You will use <code>scfb</code> driver (System Console Frame Buffer) while booting on UEFI mode. This can be checked by </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% sysctl machdep.bootmethod</span><br></pre></td></tr></table></figure><h5 id="Packages"><a href="#Packages" class="headerlink" title="Packages"></a>Packages</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># pkg install xorg xdm xterm openbox xf86-video-intel</span><br></pre></td></tr></table></figure><h5 id="Group"><a href="#Group" class="headerlink" title="Group"></a>Group</h5><p>To have hardware accelerated X11 You will also need to add your regular user to the <code>video</code> group.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># pw groupmod video -m username</span><br></pre></td></tr></table></figure><h5 id="Login-Class"><a href="#Login-Class" class="headerlink" title="Login Class"></a>Login Class</h5><p>Remember to also add UTF-8 as the default encoding in the <code>/etc/login.conf</code> file as show below. Also, after adding them, run the <code>cap_mkdb /etc/login.conf</code> command as root and relogin with your regular user.</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">+:charset=UTF-8:\</span></span><br><span class="line"><span class="addition">+:lang=en_US.UTF-8:\</span></span><br></pre></td></tr></table></figure><p>The UTF-8 encoding – same as in the <code>lang</code> parameter in the <code>/etc/login.conf</code> file – must be added at the begining of your <code>~/.xinitrc</code> file, like that:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export LC_ALL&#x3D;en_US.UTF-8</span><br></pre></td></tr></table></figure><h5 id="Kernel-Module"><a href="#Kernel-Module" class="headerlink" title="Kernel Module"></a>Kernel Module</h5><p>Most computers/laptops/servers will have integrated GPU which should be supported by the X11 <code>intel</code> driver and:</p><ul><li><code>/boot/kernel/i915kms.ko</code> from base system</li><li><code>/boot/modules/i915kms.ko</code> from <code>drm-next-kmod</code> package (port moved to graphics/drm-fbsd12.0-kmod on 2018-12-09)</li></ul><p>To add the KMS (Kernel Mode Setting) Intel module loading into the <code>/etc/rc.conf</code> file put the line below into it.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kld_list&#x3D;&quot;$&#123;kld_list&#125; i915kms&quot;</span><br></pre></td></tr></table></figure><p>In case of need to use <code>drm-next-kmod</code> module instead of the base system one, your <code>/etc/rc.conf</code> file would look like that one below.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kld_list&#x3D;&quot;$&#123;kld_list&#125; &#x2F;boot&#x2F;modules&#x2F;i915kms.ko&quot;</span><br></pre></td></tr></table></figure><p>If you find yourself in the situation that the <code>drm-next-kmod</code> would still not support your latest graphics card then you may try the latest version of the <code>drm-next-kmod</code>.</p><h5 id="X11-Window-System-Configuration"><a href="#X11-Window-System-Configuration" class="headerlink" title="X11 Window System Configuration"></a>X11 Window System Configuration</h5><p>You can just configure these parts of X11 server that You need without touching other parts. This individual configuration is done in the <code>/usr/local/etc/X11/xorg.conf.d</code> directory with individual files for each setting.</p><ul><li><p>The DontZap option is to enable the X11 server abort with <code>[CTRL] + [ALT] + [BACKSPACE]</code> shortcut.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># cat &#x2F;usr&#x2F;local&#x2F;etc&#x2F;X11&#x2F;xorg.conf.d&#x2F;flags.conf</span><br><span class="line">Section &quot;ServerFlags&quot;</span><br><span class="line">  Option &quot;DontZap&quot; &quot;off&quot;</span><br><span class="line">EndSection</span><br></pre></td></tr></table></figure></li><li><p><code>terminate:ctrl_alt_bksp</code> to allow termination of the X11 server with <code>[CTRL] + [ALT] + [BACKSPACE]</code> shortcut and <code>ctrl:nocaps</code> to ignore the Caps Lock key as I also find that useful.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># cat &#x2F;usr&#x2F;local&#x2F;etc&#x2F;X11&#x2F;xorg.conf.d&#x2F;keyboard.conf</span><br><span class="line">Section &quot;InputDevice&quot;</span><br><span class="line">  Identifier &quot;Keyboard0&quot;</span><br><span class="line">  Driver &quot;kbd&quot;</span><br><span class="line">  Option &quot;XkbLayout&quot; &quot;us&quot;</span><br><span class="line">  Option &quot;XkbOptions&quot; &quot;terminate:ctrl_alt_bksp,ctrl:nocaps&quot;</span><br><span class="line">EndSection</span><br></pre></td></tr></table></figure></li><li><p>graphics card configuration</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># cat &#x2F;usr&#x2F;local&#x2F;etc&#x2F;X11&#x2F;xorg.conf.d&#x2F;card.conf</span><br><span class="line">Section &quot;Device&quot;</span><br><span class="line">  Identifier &quot;Card0&quot;</span><br><span class="line">  Option &quot;DPMS&quot;</span><br><span class="line">  Driver &quot;intel&quot;</span><br><span class="line">EndSection</span><br></pre></td></tr></table></figure></li></ul><h5 id="XDM-or-XINIT-STARTX"><a href="#XDM-or-XINIT-STARTX" class="headerlink" title="XDM or XINIT/STARTX"></a>XDM or XINIT/STARTX</h5><p>You will also have to decide how You want to start your X11 Window Server, you may login in plan text console and then type <code>xinit</code> or <code>startx</code> to read your <code>~/.xinitrc</code> configuration and daemons or You may want to use X11 Login manager such as <code>xdm/sddm/slim</code> with <code>~/.xsession</code> configuration to load after successful login. The difference between <code>xinit</code> and <code>startx</code> is that <code>startx</code> command executes <code>xinit</code> command with arguments.</p><p>When I use <code>xinit</code> to directly start the X11 server I use an alias to <code>xinit</code> with these parameters:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alias x&#x3D;&#39;xinit ~&#x2F;.xinitrc -- -dpi 75 -nolisten tcp&#39;</span><br></pre></td></tr></table></figure><p>I keep that alias in the <code>~/.zshrc</code> file.</p><p>While <code>xinit</code> run commands based on the <code>~/.xinitrc</code> file the XDM login manager looks for the <code>~/.xsession</code> file. As You will be loading same stuff regardless of the startup method we will create a link of <code>~/.xsession</code> pointing to the <code>~/.xinitrc</code> file. This way either method You choose You will always end with started X11 session.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% ln -s ~&#x2F;.xinitrc ~&#x2F;.xsession</span><br></pre></td></tr></table></figure><p>One more case about the <code>~/.xinitrc</code> (or <code>~/.xsession</code>) file. It is interpreted as a shell script (and yes you can do <code>if/then/else/fi</code> and <code>case/esac</code> or <code>for/while</code> POSIX shell scripting in it) but it does not need to be executable. The last command in this file MUST NOT to be put in the background (must be without the <code>&amp;</code> char at the end) because the X11 session will end.</p><h5 id="XDM-Black-Theme"><a href="#XDM-Black-Theme" class="headerlink" title="XDM Black Theme"></a>XDM Black Theme</h5><p>To configure this black XDM theme You will need to modify contents of two files as show below.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># cat &#x2F;usr&#x2F;local&#x2F;etc&#x2F;X11&#x2F;xdm&#x2F;Xsetup_0</span><br><span class="line">xsetroot -solid black</span><br></pre></td></tr></table></figure><p>This we will set black background on the login screen on the :<code>0</code> X11 server – the default one.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># cat &#x2F;usr&#x2F;local&#x2F;etc&#x2F;X11&#x2F;xdm&#x2F;Xresources</span><br><span class="line">xlogin.Login.greeting:</span><br><span class="line">xlogin.Login.unsecureGreeting:</span><br><span class="line">xlogin.Login.fail:                Fail.</span><br><span class="line">xlogin.Login.changePasswdMessage: Change.</span><br><span class="line">xlogin.Login.namePrompt:          Username:</span><br><span class="line">xlogin.Login.passwdPrompt:        Password:</span><br><span class="line">xlogin.Login.echoPasswd:          true</span><br><span class="line">xlogin.Login.background:          black</span><br><span class="line">xlogin.Login.foreground:          white</span><br><span class="line">xlogin.Login.failColor:           #cccccc</span><br><span class="line">xlogin.Login.inpColor:            black</span><br><span class="line">xlogin.Login.promptColor:         #aaaaaa</span><br><span class="line">xlogin.Login.face:                courier:size&#x3D;13:style&#x3D;Bold</span><br><span class="line">xlogin.Login.failFace:            courier:size&#x3D;13:style&#x3D;Bold</span><br><span class="line">xlogin.Login.promptFace:          courier:size&#x3D;13:style&#x3D;Normal</span><br><span class="line">xlogin.Login.greetFace:           courier:size&#x3D;13</span><br><span class="line">xlogin.Login.width:               400</span><br></pre></td></tr></table></figure><img data-src="/2020/11/28/FreeBSD-Desktop/xdm-black.png" class="" title="FreeBSD"><h5 id="Client-Configuration"><a href="#Client-Configuration" class="headerlink" title="Client Configuration"></a>Client Configuration</h5><p> the simple <code>~/.xinitrc</code> file with <code>Openbox</code> window manager, prestarted <code>xterm</code> terminal and black background for our simple session.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">% cat ~&#x2F;.xinitrc</span><br><span class="line"># SET PROPER locale(1) with LC_ALL VARIABLE.</span><br><span class="line">  export LC_ALL&#x3D;en_US.UTF-8</span><br><span class="line"></span><br><span class="line"># PRESTARTED APPS</span><br><span class="line">  xterm &amp;</span><br><span class="line">  xsetroot -solid black &amp;</span><br><span class="line"></span><br><span class="line"># WINDOW MANAGER</span><br><span class="line">  openbox</span><br></pre></td></tr></table></figure><img data-src="/2020/11/28/FreeBSD-Desktop/desktop.png" class="" title="FreeBSD"><h5 id="Using-modesetting-Driver"><a href="#Using-modesetting-Driver" class="headerlink" title="Using modesetting Driver"></a>Using modesetting Driver</h5><p>If you use <code>i915kms</code> kernel module, you don’t need to install <code>xf86-video-intel</code>, the <code>modesetting</code> generic DDX driver that is built in the X server, will do just well. The xf86-video-intel might even cause you troubles.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># cat &#x2F;usr&#x2F;local&#x2F;etc&#x2F;X11&#x2F;xorg.conf.d&#x2F;card.conf</span><br><span class="line">Section &quot;Device&quot;</span><br><span class="line">  Identifier &quot;Card0&quot;</span><br><span class="line">  Option &quot;DPMS&quot;</span><br><span class="line">  Driver &quot;modesetting&quot;</span><br><span class="line">EndSection</span><br></pre></td></tr></table></figure><h5 id="Using-Dedicated-video-Login-Class-Instead-of-Global-One"><a href="#Using-Dedicated-video-Login-Class-Instead-of-Global-One" class="headerlink" title="Using Dedicated video: Login Class Instead of Global One"></a>Using Dedicated video: Login Class Instead of Global One</h5><p>If you modify <code>/etc/login.conf</code>, you are modifying the systemwide locale for the default login class to which all users belong (also user www for Apache, for example).</p><p>Add this login class to the <code>/etc/login.conf</code> file.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">video:\</span><br><span class="line">        :charset&#x3D;UTF-8:\</span><br><span class="line">        :lang&#x3D;en_US.UTF-8:\</span><br><span class="line">        :tc&#x3D;default:</span><br></pre></td></tr></table></figure><p>Rebuild the login class database.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># cap_mkdb &#x2F;etc&#x2F;login.conf</span><br></pre></td></tr></table></figure><p>Lets set the login class to video for the vuk user.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># pw usermod -L video -n vuk</span><br></pre></td></tr></table></figure><p>How the account looks after setting the login class.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># grep vuk &#x2F;etc&#x2F;master.passwd</span><br><span class="line">vuk:&#123;REMOVED&#125;:1000:1000:video:0:0:vuk:&#x2F;home&#x2F;vuk:&#x2F;bin&#x2F;sh</span><br></pre></td></tr></table></figure><p>Now logout and login again to make that work. View the changes through the <code>locale</code> command.</p><h5 id="Tap-to-Click-on-Synaptics-Touchpad"><a href="#Tap-to-Click-on-Synaptics-Touchpad" class="headerlink" title="Tap to Click on Synaptics Touchpad"></a>Tap to Click on Synaptics Touchpad</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># pkg install xf86-input-synaptics</span><br><span class="line"></span><br><span class="line"># cat &#x2F;usr&#x2F;local&#x2F;etc&#x2F;X11&#x2F;xorg.conf.d&#x2F;touchpad.conf</span><br><span class="line">Section &quot;InputClass&quot;</span><br><span class="line">  Identifier &quot;touchpad&quot;</span><br><span class="line">  MatchIsTouchpad &quot;on&quot;</span><br><span class="line">  Driver &quot;libinput&quot;</span><br><span class="line">  Option &quot;Tapping&quot; &quot;on&quot;</span><br><span class="line">EndSection</span><br></pre></td></tr></table></figure><h3 id="Key-Components"><a href="#Key-Components" class="headerlink" title="Key Components"></a>Key Components</h3><h5 id="Window-Manager"><a href="#Window-Manager" class="headerlink" title="Window Manager"></a>Window Manager</h5><p>The <span class="exturl" data-url="aHR0cHM6Ly93d3cuYm94LWxvb2sub3JnL3AvMTAxNzgzMi8=">TWM<i class="fa fa-external-link-alt"></i></span> <em>Openbox</em> theme.</p><img data-src="/2020/11/28/FreeBSD-Desktop/openbox-theme-twm.png" class="" title="FreeBSD"><p>If You would like to increase your knowledge about Openbox then check the official documentation: <span class="exturl" data-url="aHR0cDovL29wZW5ib3gub3JnL3dpa2kvTWFpbl9QYWdl">Openbox<i class="fa fa-external-link-alt"></i></span></p><h5 id="Status-Bar"><a href="#Status-Bar" class="headerlink" title="Status Bar"></a>Status Bar</h5><p>Also known as information bar, the place on the screen that would provide You needed information such as current date and time, CPU, RAM and storage usage, current network information or battery status.</p><ul><li>While <code>Xmobar</code> is nice solution it comes with about 2 GB of dependencies of Haskell and Haskell libraries.</li><li>While <code>Polybar</code> can look very nice on screenshots it is a lot more heavy on resources and is limited only to modules/features that were implemented in it.</li></ul><img data-src="/2020/11/28/FreeBSD-Desktop/openbox-polybar.jpg" class="" title="FreeBSD"><ul><li>I have used <code>Conky</code> for quite long time but after recent tests I made <code>Dzen2</code> is a lot less on resources then Conky while doing the same thing. </li></ul><h5 id="Task-Bar"><a href="#Task-Bar" class="headerlink" title="Task Bar"></a>Task Bar</h5><p>A taskbar is an element of a graphical user interface which has various purposes. It typically shows which programs are currently running.</p><ul><li>You can use classic taskbar like <code>XFCE Panel</code> used in the XFCE desktop environment.</li></ul><img data-src="/2020/11/28/FreeBSD-Desktop/taskbar-xfce.png" class="" title="FreeBSD"><ul><li>You can also configure <code>Tint2</code> that way. But it only shows applications that are active on the current desktop.</li></ul><img data-src="/2020/11/28/FreeBSD-Desktop/taskbar-tint-classic.jpg" class="" title="FreeBSD"><ul><li>One of the greatest taskbars of all time was/is the Mac OS X Dock (now macOS Dock).  It also has an indicator showing if application is launched. Currently the best and lightest solution for providing the dock-like functionality on open desktops seems to be <code>Plank</code>.</li></ul><img data-src="/2020/11/28/FreeBSD-Desktop/taskbar-plank-eos.png" class="" title="FreeBSD"><h5 id="Wallpaper-Handling"><a href="#Wallpaper-Handling" class="headerlink" title="Wallpaper Handling"></a>Wallpaper Handling</h5><p>Some people have a set of favorite wallpapers and setup random wallpaper from this set of favorites to show up every once in a while.</p><p>While <code>Feh</code> main/original function is to be ultra fast image viewer it also has an option to properly setup a wallpaper on a X11 desktop.</p><h5 id="Application-Launcher"><a href="#Application-Launcher" class="headerlink" title="Application Launcher"></a>Application Launcher</h5><p>While not being any crucial role of the desktop environment it have its uses and sometimes save time.</p><p>Lets start with resources, the <code>Rofi</code> implementation of application launcher uses almost 3 times more RAM  then <code>Dmenu</code> solution.</p><ul><li>Desktop with Dmenu launched and with <code>alc</code> characters inserted to ‘filter’ commands in the search of a calculator application.</li></ul><img data-src="/2020/11/28/FreeBSD-Desktop/launcher-dmenu-run.jpg" class="" title="FreeBSD"><ul><li><p>The Rofi requires simple command.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% rofi -show run -theme solarized_alternate -font &quot;Monaco 8&quot;</span><br></pre></td></tr></table></figure></li></ul><img data-src="/2020/11/28/FreeBSD-Desktop/launcher-rofi.jpg" class="" title="FreeBSD"><h5 id="Keyboard-Mouse-Shortcuts"><a href="#Keyboard-Mouse-Shortcuts" class="headerlink" title="Keyboard/Mouse Shortcuts"></a>Keyboard/Mouse Shortcuts</h5><p>While most window managers and desktop environments offer some kind of shortcuts or tools to define your own ones. its often quite complicated to force them to do exactly what you want. </p><ul><li>The <code>xev</code> is used to read what has keyboard key has been pressed or which mouse button was used.</li></ul><img data-src="/2020/11/28/FreeBSD-Desktop/keyboard-xev.jpg" class="" title="FreeBSD"><ul><li>The <code>Xmodmap</code> is used to assign or rename keys to make something different.</li><li>Similarly like xev the <code>xbindkeys</code> comes with its own window to catch events.</li></ul><img data-src="/2020/11/28/FreeBSD-Desktop/keyboard-xbindkeys.jpg" class="" title="FreeBSD"><ul><li>Sometimes you want to fake that some keys were pressed – but without pressing them. This is where <code>xdotool</code> comes handy – it can generate any keyboard shortcut and send it to and application in X11 environment. </li></ul><h5 id="Locking-Solution"><a href="#Locking-Solution" class="headerlink" title="Locking Solution"></a>Locking Solution</h5><ul><li>From all the nice looking solutions providing screen lock on the X11 I found <code>mate-screensaver</code> the best choice for this task ( saves battery time ). The mate-screensaver has to be started and run in the background with, well <code>mate-screensaver</code> command – placed somewhere in the <code>~/.xinitrc</code> or <code>~/.xsession</code> file. Then we would be able to invoke <code>mate-screensaver-command --lock</code> command to make the actual screen lock.</li></ul><img data-src="/2020/11/28/FreeBSD-Desktop/locker-mate-screensaver.png" class="" title="FreeBSD"><ul><li><p>When mate-screensaver will not be available or functional we will use <code>xlock</code> as failover solution. The xlock tool appearance can be configured by specifying arguments.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">FONT&#x3D;&#39;-*-fixed-*-*-*-*-10-*-*-*-*-*-iso8859-2&#39;</span><br><span class="line">xlock \</span><br><span class="line">  -mode image \</span><br><span class="line">  -planfont &quot;$&#123;FONT&#125;&quot; \</span><br><span class="line">  -font     &quot;$&#123;FONT&#125;&quot; \</span><br><span class="line">  -username &#39;user: &#39; \</span><br><span class="line">  -password &#39;pass:&#39; \</span><br><span class="line">  -info &#39; &#39; \</span><br><span class="line">  -validate &#39;Checking.&#39; \</span><br><span class="line">  -invalid &#39;Nope. &#39; \</span><br><span class="line">  -background gray20 \</span><br><span class="line">  -foreground gray60 \</span><br><span class="line">  -dpmsoff 1 \</span><br><span class="line">  -icongeometry 64x64 \</span><br><span class="line">  -echokeys \</span><br><span class="line">  -echokey &#39;*&#39; \</span><br><span class="line">  -bitmap &#x2F;home&#x2F;vermaden&#x2F;.icons&#x2F;vermaden&#x2F;xlock.xpm \</span><br><span class="line">  -count 1 \</span><br><span class="line">  -delay 10000000 \</span><br><span class="line">  -erasemode no_fade \</span><br><span class="line">  +showdate \</span><br><span class="line">  +description</span><br></pre></td></tr></table></figure></li></ul><img data-src="/2020/11/28/FreeBSD-Desktop/xlock-user-pass.png" class="" title="FreeBSD"><ul><li><p>The <code>xautolock</code> will be used to automatically lock the screen (invoke mate-screensaver or xlock command) after defined period of inactivity time.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">% xautolock \</span><br><span class="line">    -time 1 \</span><br><span class="line">    -locker \</span><br><span class="line">    ~&#x2F;bin&#x2F;example-lock-handler.sh \</span><br><span class="line">    -resetsaver</span><br></pre></td></tr></table></figure><p>The xautolock also has to be started and run in the background using the <code>~/.xinitrc</code> or <code>~/.xsession</code> file.</p></li></ul><h5 id="Blue-Light-Spectrum-Suppress"><a href="#Blue-Light-Spectrum-Suppress" class="headerlink" title="Blue Light Spectrum Suppress"></a>Blue Light Spectrum Suppress</h5><p>Automatically adjusts color temperature of the screen according to your current time in your location.</p><ul><li><p>While <span class="exturl" data-url="aHR0cHM6Ly9qdXN0Z2V0Zmx1eC5jb20v">F.lux<i class="fa fa-external-link-alt"></i></span>  (closed source) does not provide a native binary for FreeBSD it does offer such binary for Linux and as FreeBSD provides Linux Binary Compatibility its possible to use it on FreeBSD. To use F.lux just start it in the <code>~/.xinitrc</code> or <code>~/.xsession</code> file like that.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~&#x2F;path&#x2F;to&#x2F;bin&#x2F;xflux -l 33.54321 -g 11.12345 &amp;</span><br></pre></td></tr></table></figure><p>Of course 33.54321 is latitude and 11.12345 is longitude of your localization.</p></li><li><p><code>Redshift</code> is the solution that I propose to use as open source blue light spectrum suppressor. Similarly like with the F.lux to start Redshift just put it in the <code>~/.xinitrc</code> or <code>~/.xsession</code> file like that.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% redshift -l 33.54321:11.12345 -g 0.9 &amp;</span><br></pre></td></tr></table></figure></li><li><p>Someone else suggested trying <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtaXIvc2N0ZA==">sctd<i class="fa fa-external-link-alt"></i></span> which is sct but rewritten/modified to be a daemon that will automatically change the color temperature during the day (or night). The sctd uses smaller about of RAM memory, uses less libraries and size of these libraries is smaller then what redshfit needs. </p></li></ul><h3 id="参见"><a href="#参见" class="headerlink" title="参见"></a>参见</h3><p><span class="exturl" data-url="aHR0cHM6Ly92ZXJtYWRlbi53b3JkcHJlc3MuY29tL2ZyZWVic2QtZGVza3RvcC8=">FreeBSD Desktop | 𝚟𝚎𝚛𝚖𝚊𝚍𝚎𝚗 (wordpress.com)<i class="fa fa-external-link-alt"></i></span></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;The FreeBSD Desktop series are about creating efficient desktop environment on the FreeBSD system.&lt;/p&gt;</summary>
    
    
    
    
    <category term="Unix" scheme="https://vanehsiung.github.io/tags/Unix/"/>
    
  </entry>
  
  <entry>
    <title>Microservices</title>
    <link href="https://vanehsiung.github.io/2020/11/26/Microservices/"/>
    <id>https://vanehsiung.github.io/2020/11/26/Microservices/</id>
    <published>2020-11-26T06:17:19.000Z</published>
    <updated>2020-11-26T12:22:41.839Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>定义：“微服务架构”这个术语描述这样一种特定的软件设计方法，即以若干组可独立部署的服务的方式进行软件应用系统的设计。</p><a id="more"></a><h3 id="单体应用"><a href="#单体应用" class="headerlink" title="单体应用"></a>单体应用</h3><p>一个单体应用系统（即服务端应用系统，一个单个可执行的逻辑程序）是以一个单个单元的方式来构建的。处理用户请求的所有逻辑都运行在一个单个的进程内。通过精心设计，就能在开发人员的笔记本电脑上运行和测试这样的应用系统，并且使用一个部署流水线来确保变更被很好地进行了测试，然后部署到生产环境中。但是渐渐地，特别是随着越来越多的应用系统正被部署到云端，软件变更受到了很大的限制，应用系统的一个很小的部分的一处变更，也需要将整个单体应用系统进行重新构建和部署。这导致了微服务架构风格的诞生：以构建一组小型服务的方式来构建应用系统。</p><h5 id="单体应用架构"><a href="#单体应用架构" class="headerlink" title="单体应用架构"></a>单体应用架构</h5><p>一个单体应用，往往将应用所有功能都打包在一起：</p><img data-src="/2020/11/26/Microservices/monolithic0.webp" class="" title="monolithic"><p>当用户访问量变大导致一台服务器无法支撑时，就加服务器加负载均衡：</p><img data-src="/2020/11/26/Microservices/monolithic1.webp" class="" title="monolithic"><p>之后把静态文件独立出来，通过 CDN 等进行加速，提升单体应用的整体响应：</p><img data-src="/2020/11/26/Microservices/monolithic2.webp" class="" title="monolithic"><h3 id="微服务"><a href="#微服务" class="headerlink" title="微服务"></a>微服务</h3><p>微服务架构风格这种开发方法，是以开发一组小型服务的方式来开发一个独立的应用系统的。其中每个小型服务都运行在自己的进程中，并经常采用HTTP资源API这样轻量的机制来相互通信。这些服务围绕业务功能进行构建，并能通过全自动的部署机制来进行独立部署。这些微服务可以使用不同的语言来编写，并且可以使用不同的数据存储技术。对这些微服务我们仅做最低限度的集中管理。</p><img data-src="/2020/11/26/Microservices/microservices0.webp" class="" title="microservices"><h5 id="微服务架构"><a href="#微服务架构" class="headerlink" title="微服务架构"></a>微服务架构</h5><p>微服务架构，核心是为了解决应用微服务之后的服务治理问题。</p><p>第一个问题就是服务发现问题，解决方法是服务注册中心：</p><img data-src="/2020/11/26/Microservices/microservices6.webp" class="" title="microservices"><p>第二个问题是服务配置管理的问题，解决方案是配置中心：</p><img data-src="/2020/11/26/Microservices/microservices7.webp" class="" title="microservices"><p>以上是应用内部的服务治理，当客户端或外部应用调用服务的时候就需要使用到服务网关提供统一的服务入口，最终形成典型微服务架构：</p><img data-src="/2020/11/26/Microservices/microservices8.webp" class="" title="microservices"><h3 id="微服务架构的九大特性"><a href="#微服务架构的九大特性" class="headerlink" title="微服务架构的九大特性"></a>微服务架构的九大特性</h3><p>不存在微服务架构风格的正式定义。但是可以描述所见到的能够被贴上微服务标签的那些架构的共性。</p><h5 id="特性一：“组件化”与“多服务”"><a href="#特性一：“组件化”与“多服务”" class="headerlink" title="特性一：“组件化”与“多服务”"></a>特性一：“组件化”与“多服务”</h5><p>微服务架构也会使用软件库，但其将自身软件进行组件化的主要方法是将软件分解为诸多服务。</p><ul><li>组件定义：一个组件就是一个可以独立更换和升级的软件单元。</li><li>软件库定义：它能被链接到一段程序，且能通过内存中的函数来进行调用。是进程内的组件。</li><li>服务：是进程外的组件，它们通过诸如web service请求或远程过程调用这样的机制来进行通信。</li></ul><p>以使用服务（而不是以软件库）的方式来实现组件化的原因是：</p><ul><li>服务可被独立部署。如果一个应用系统由在单个进程中的多个软件库所组成，那么对任一组件做一处修改，都不得不重新部署整个应用系统。但是如果该应用系统被分解为多个服务，那么对于一个服务的多处修改，仅需要重新部署这一个服务。</li><li>能获得更加显式的组件接口。通过使用显式的远程调用机制，服务能更容易地避免客户端破坏组件的封装，从而导致组件间出现过度紧密的耦合。</li></ul><p>不足：</p><ul><li>比起进程内调用，远程调用更加昂贵。</li><li>如果需要修改组件间的职责分配，那么当跨越进程边界时，这种组件行为的改动会更加难以实现。</li></ul><h5 id="特性二：围绕“业务功能”组织团队"><a href="#特性二：围绕“业务功能”组织团队" class="headerlink" title="特性二：围绕“业务功能”组织团队"></a>特性二：围绕“业务功能”组织团队</h5><p>康威定律：</p><blockquote><p>任何设计（广义上的）系统的组织，都会产生这样一个设计，即该设计的结构与该组织的沟通结构相一致。</p><footer><strong>Melvyn Conway</strong></footer></blockquote><p>当在寻求将一个大型应用系统分解成几部分时，公司管理层往往会聚焦在技术层面上。这会导致组建用户界面团队、服务器端团队和数据库团队。</p><img data-src="/2020/11/26/Microservices/microservices1.webp" class="" title="microservices"><p>当团队沿着这些技术线分开后，即使要实现软件一个简单的变更，也会导致跨团队的项目时延和预算审批。在这种情况下，聪明的团队会进行局部优化，直接把代码逻辑塞到他们能访问到的任意应用系统中。</p><p>微服务根据业务功能来将系统分解为若干服务。这些服务针对该业务领域提供多层次广泛的软件实现，包括用户界面、持久性存储以及任何对外的协作性操作。因此，团队是跨职能的。</p><img data-src="/2020/11/26/Microservices/microservices2.webp" class="" title="microservices"><h5 id="特性三：“做产品”而不是“做项目”"><a href="#特性三：“做产品”而不是“做项目”" class="headerlink" title="特性三：“做产品”而不是“做项目”"></a>特性三：“做产品”而不是“做项目”</h5><p>项目模型：目标是交付某一块软件。一旦完工后，软件就被移交给维护团队，构建该软件的项目团队就会被解散。</p><p>微服务模型（产品理念）：一个团队在一个产品的整个生命周期中都应该保持对其拥有。这会使开发人员每天都会关注软件是如何在生产环境下运行的，并且增进他们与用户的联系，因为他们必须承担某些支持工作。</p><h5 id="特性四：“智能端点”与“傻瓜管道”"><a href="#特性四：“智能端点”与“傻瓜管道”" class="headerlink" title="特性四：“智能端点”与“傻瓜管道”"></a>特性四：“智能端点”与“傻瓜管道”</h5><p>当在不同的进程之间构建各种通信结构时，许多产品和方法强调将大量的智能特性纳入通信机制本身。</p><p>微服务社区主张智能端点和傻瓜管道。使用微服务所构建的各个应用的目标，都是尽可能地实现“高内聚和低耦合”——他们拥有自己的领域逻辑，并且更多地是像经典Unix的“过滤器”那样来工作。这些应用通过使用一些简单的REST风格的协议来进行编制，而不去使用复杂的协议。</p><p>微服务最常用的两种协议是：带有资源API的HTTP“请求－响应”协议，和轻量级的消息发送协议。对于前一种协议的最佳表述是：</p><blockquote><p>Be of the web, not behind the web</p><footer><strong>Ian Robinson</strong></footer></blockquote><h5 id="特性五：“去中心化”地治理技术"><a href="#特性五：“去中心化”地治理技术" class="headerlink" title="特性五：“去中心化”地治理技术"></a>特性五：“去中心化”地治理技术</h5><p>使用中心化的方式来对开发进行治理，其中一个后果，就是趋向于在单一技术平台上制定标准。我们更喜欢根据工作的不同来选用合理的工具。</p><h5 id="特性六：“去中心化”地管理数据"><a href="#特性六：“去中心化”地管理数据" class="headerlink" title="特性六：“去中心化”地管理数据"></a>特性六：“去中心化”地管理数据</h5><p>去中心化地管理数据，其表现形式多种多样。从最抽象的层面看，这意味着各个系统对客观世界所构建的概念模型，将彼此各不相同。微服务趋向使用“实战检验”的标准而非“强制执行”的标准。</p><p>如同在概念模型上进行去中心化的决策一样，微服务也在数据存储上进行去中心化的决策。单体应用在逻辑上各自使用一个单独的数据库来持久化数据，但是各家企业往往喜欢一系列单体应用共用一个单独的数据库。微服务更喜欢让每一个服务来管理其自有数据库。这种方法被称作“多语种持久化”。</p><img data-src="/2020/11/26/Microservices/microservices3.webp" class="" title="microservices"><h5 id="特性七：“基础设施”自动化"><a href="#特性七：“基础设施”自动化" class="headerlink" title="特性七：“基础设施”自动化"></a>特性七：“基础设施”自动化</h5><p>基础设施自动化技术已经得到长足的发展。云的演进，特别是AWS的发展，已经降低了构建、部署和运维微服务的操作复杂性。</p><p>构建流水线：</p><img data-src="/2020/11/26/Microservices/microservices4.webp" class="" title="microservices"><p>部署在单块系统和微服务上没什么区别。然而，两者在运维领域的情况却截然不同：</p><img data-src="/2020/11/26/Microservices/microservices5.webp" class="" title="microservices"><h5 id="特性八：“容错”设计"><a href="#特性八：“容错”设计" class="headerlink" title="特性八：“容错”设计"></a>特性八：“容错”设计</h5><p>使用各个微服务来替代组件，其结果是各个应用程序需要设计成能够容忍这些服务所出现的故障。</p><p>因为各个服务可以在任何时候发生故障，所以两件事就变得很重要，即能够快速地检测出故障，且在可能的情况下能够自动恢复服务。</p><h5 id="特性九：“演进式”设计"><a href="#特性九：“演进式”设计" class="headerlink" title="特性九：“演进式”设计"></a>特性九：“演进式”设计</h5><p>微服务的从业者们将服务的分解，视作一个额外的工具，来让应用开发人员能够控制应用系统中的变化，而无须减少变化的发生。</p><p>要将软件系统分解为各个组件时，决定切分应用系统时应该遵循的原则是：一个组件的关键属性，是具有独立更换和升级的特点。</p><p>这种强调可更换性的特点，是模块化设计一般性原则的一个特例，通过“变化模式”来驱动进行模块化的实现。将那些同时发生变化的东西，放到同一个模块中；很少发生变化的部分，放到不同的服务中。如果发现需要同时反复变更两个服务，这就是它们需要被合并信号。</p><h3 id="微服务框架"><a href="#微服务框架" class="headerlink" title="微服务框架"></a>微服务框架</h3><ul><li>Spring Cloud</li></ul><img data-src="/2020/11/26/Microservices/Spring%20Cloud.webp" class="" title="Spring Cloud"><ul><li>Dubbo</li></ul><img data-src="/2020/11/26/Microservices/Dubbo.png" class="" title="Dubbo"><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p><span class="exturl" data-url="aHR0cHM6Ly9tYXJ0aW5mb3dsZXIuY29tL2FydGljbGVzL21pY3Jvc2VydmljZXMuaHRtbA==">Microservices<i class="fa fa-external-link-alt"></i></span></p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC83MjkzYjE0ODAyOGY=">微服务入门这一篇就够了<i class="fa fa-external-link-alt"></i></span></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;定义：“微服务架构”这个术语描述这样一种特定的软件设计方法，即以若干组可独立部署的服务的方式进行软件应用系统的设计。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Architecture" scheme="https://vanehsiung.github.io/tags/Architecture/"/>
    
  </entry>
  
  <entry>
    <title>Linux Deploy</title>
    <link href="https://vanehsiung.github.io/2020/11/24/Linux-Deploy/"/>
    <id>https://vanehsiung.github.io/2020/11/24/Linux-Deploy/</id>
    <published>2020-11-24T07:44:19.000Z</published>
    <updated>2020-11-24T08:21:54.861Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>这是一篇旧文章，做个记录。</p><a id="more"></a><h3 id="通过-Linux-Deploy-在-Android-上安装-Linux"><a href="#通过-Linux-Deploy-在-Android-上安装-Linux" class="headerlink" title="通过 Linux Deploy 在 Android 上安装 Linux"></a>通过 Linux Deploy 在 Android 上安装 Linux</h3><h5 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h5><p>一个 Root 了的 Android 手机</p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuYnVzeWJveC5uZXQv">Busy Box<i class="fa fa-external-link-alt"></i></span>：Linux Deploy 支撑软件。</p><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL21lZWZpay9saW51eGRlcGxveS9yZWxlYXNlcw==">Linux deploy<i class="fa fa-external-link-alt"></i></span>：Linux 系统支撑软件。</p><h5 id="安装-Busy-Box"><a href="#安装-Busy-Box" class="headerlink" title="安装 Busy Box"></a>安装 Busy Box</h5><p>点击安装，等待程序自行运行，在界面中输出 <code>## END</code> 后退出程序。</p><h5 id="Linux-deploy"><a href="#Linux-deploy" class="headerlink" title="Linux deploy"></a>Linux deploy</h5><ul><li>点击左图左上角部分，选择 <strong>设置</strong>，在设置界面中找到PATH变量，赋予其值 <code>/system/xbin</code>。</li><li>建议开启 <strong>锁定Wifi</strong> 功能。</li><li>接着退回主界面，点击右下角部分。</li><li><strong>发行版</strong> 看个人喜好选择，Debian 系（Debian，Kaili，Ubuntu）较热门。</li><li><strong>架构</strong> 默认。</li><li><strong>源</strong> 默认。如果下的慢的话，就仿照默认的源换为国内的源，如 <span class="exturl" data-url="aHR0cDovL21pcnJvcnMudXN0Yy5lZHUuY24v">USTC MIRRORS<i class="fa fa-external-link-alt"></i></span>，但是不要特意去换源，官方的源用的了的话官方的源最好。</li><li><strong>安装路径</strong> ：安装在手机自带的存储空间中，则在路径开头加上<code>$&#123;ENV_DIR&#125;</code>；安装在 <strong>sdcard</strong> 中，加上<code>$&#123;EXTERNAL_STORAGE&#125;</code>。</li><li><strong>文件系统</strong> ：推荐 <code>ext4</code>。</li><li><strong>用户名</strong> 和 <strong>密码</strong> 自定义。</li><li><strong>DNS</strong> 默认。</li><li><strong>本地化</strong> ：简体中文可以选择 <code>zh_CN.UTF-8</code>，建议选择 <code>en_US.UTF-8</code> 。</li><li><strong>挂载列表</strong>：添加访问手机内容的目录，<strong>手机目录：挂载点</strong>，如 <code>/sdcard:/mnt</code>，之后会自动挂载。</li><li>**开启<code>SSH</code>**。</li><li><strong>图形界面功能</strong>，需要的话就选 <code>XFce</code> 为桌面，XFce`是轻量级桌面环境。</li><li>退出系统设置界面，点击主界面右上角，选择安装。<br>  等待程序自行安装Linux系统，开始时会自动创造一个4G左右大小的img文件，这个是默认的大小，你可以根据你手机的容量自定义，创造文件需要一点时间，屏幕会很安静，再然后会安装各种东西，屏幕会输出很多信息，根据你的源的速度，等待时间不等，看到 <code>&lt;&lt;&lt;deploy</code> 则安装完毕。如果中间没有 <code>failed</code> 则安装成功。安装失败的话就需要重新安装，换个快一点的网，或者好一点的源。</li><li> <strong>注意：安装完毕后要先点击停止按钮，再按启动按钮</strong>。这个很重要，不然你就得重装了。</li></ul><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ul><li><p>Andorid 端用 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nvbm5lY3Rib3QvY29ubmVjdGJvdC9yZWxlYXNlcw==">ConnectBox<i class="fa fa-external-link-alt"></i></span></p></li><li><p>Windows用  <span class="exturl" data-url="aHR0cHM6Ly93d3cuY2hpYXJrLmdyZWVuZW5kLm9yZy51ay9+c2d0YXRoYW0vcHV0dHkvbGF0ZXN0Lmh0bWw=">putty<i class="fa fa-external-link-alt"></i></span> ，图形界面用 <span class="exturl" data-url="aHR0cHM6Ly93d3cucmVhbHZuYy5jb20vZW4vY29ubmVjdC9kb3dubG9hZC92aWV3ZXIv">VNC Viewer<i class="fa fa-external-link-alt"></i></span>。VNC Viewer 直接搜主机IP就行，VNC Server 在你选择安装图形界面功能时就自动安装了，不需要再安装 vnc4server。</p></li><li><p>Linux 输入<code>ssh username@hostname</code>就行。</p></li></ul><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ul><li><p>安装后如果用 vnc viewer 只有一个点的话，可以换一个发行版，我尝试的 CentOS 有这个问题。</p></li><li><p>Linux连的时候出现 <code>WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!</code>：</p>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -R + 输入服务器的IP</span><br></pre></td></tr></table></figure></li><li><p>altarch 架构的手机 CentOS 系统换源</p>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ cp CentOS-7-armhfp.repo CentOS-Base.repo</span><br><span class="line">$ mv CentOS-7-armhfp.repo CentOS-7-armhfp.repo.backup</span><br><span class="line">$ vi CentOS-Base.repo</span><br><span class="line">baseurl&#x3D;https:&#x2F;&#x2F;mirrors.ustc.edu.cn&#x2F;centos-altarch&#x2F;7.6.1810&#x2F;os&#x2F;armhfp&#x2F;</span><br><span class="line">$ yum makecache</span><br><span class="line">$ yum update</span><br></pre></td></tr></table></figure></li><li><p><strong>如果你之前没有安装VNC的话，现在又想装：</strong></p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum -y install tigervnc-server</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;这是一篇旧文章，做个记录。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Unix" scheme="https://vanehsiung.github.io/tags/Unix/"/>
    
  </entry>
  
  <entry>
    <title>Conversation</title>
    <link href="https://vanehsiung.github.io/2020/11/21/Conversation/"/>
    <id>https://vanehsiung.github.io/2020/11/21/Conversation/</id>
    <published>2020-11-21T10:37:12.000Z</published>
    <updated>2020-11-22T01:18:29.715Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><img data-src="/2020/11/21/Conversation/The%20Silent%20League.jpg" class="" title="The Silent League"><blockquote class="blockquote-center"><p>Just a little conversation<br>About give me your picture<br>On the cover of a magazine<br>On the cover of a magazine<br>Just a little conversation<br>But how long it might take one?<br>To get along with such thing?<br>To get along with such thing?<br>But everybody knows<br>It’s easier to fall apart<br>Just a little conversation<br>About give me your picture<br>On the cover of a magazine<br>On the cover of a magazine</p></blockquote><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=298 height=52 src="//music.163.com/outchain/player?type=2&id=3716423&auto=0&height=32"></iframe>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="Lyrics" scheme="https://vanehsiung.github.io/tags/Lyrics/"/>
    
  </entry>
  
  <entry>
    <title>FreeBSD</title>
    <link href="https://vanehsiung.github.io/2020/11/17/FreeBSD/"/>
    <id>https://vanehsiung.github.io/2020/11/17/FreeBSD/</id>
    <published>2020-11-17T11:55:35.000Z</published>
    <updated>2020-11-30T14:11:58.359Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>FreeBSD 計劃的目標在於提供可作任意用途的軟體而不附帶任何限制條文。 我們之中許多人對程式碼 (以及計畫本身) 都有非常大的投入， 因此，當然不介意偶爾有一些資金上的補償，但我們並沒打算堅決地要求得到這類資助。 我們認為我們的首要“使命”是為任何人提供程式碼， 不管他們打算用這些程式碼做什麼， 因為這樣程式碼將能夠被更廣泛地使用，從而發揮其價值。 我認為這是自由軟體最基本的，同時也是我們所倡導的一個目標。</p><p>我們程式碼樹中，有若干是以 GNU 通用公共授權條款 (GPL) 或者 GNU 較寬鬆通用公共授權條款 (LGPL) 發佈的那些程式碼帶有少許的附加限制，還好只是強制性的要求開放程式碼而不是別的。 由於使用 GPL 的軟體在商業用途上會增加若干複雜性，因此，如果可以選擇的話， 我們會比較喜歡使用限制相對更寬鬆的 BSD 版權來發佈軟體。</p><footer><strong>Jordan Hubbard</strong><cite><span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZWJzZC5vcmcvZG9jL3poX1RXL2Jvb2tzL2hhbmRib29rLw==">FreeBSD Handbook<i class="fa fa-external-link-alt"></i></span></cite></footer></blockquote><a id="more"></a><h3 id="FreeBSD-Beginner"><a href="#FreeBSD-Beginner" class="headerlink" title="FreeBSD Beginner"></a>FreeBSD Beginner</h3><p>如果从没有了解过 FreeBSD，请看如下：</p><ul><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZWJzZC5vcmcvZG9jL3poX1RXL2Jvb2tzL2hhbmRib29rL2ludHJvZHVjdGlvbi5odG1s">FreeBSD 简介<i class="fa fa-external-link-alt"></i></span>：<ul><li>使用 FreeBSD 使用手冊繁体中文版，繁体中文版较之简体中文版更新。</li><li>对于 FreeBSD 使用所需的一切知识，都可以在 FreeBSD 使用手册中找到；对于 FreeBSD 使用过程中遇到的一切问题，都可以在 <span class="exturl" data-url="aHR0cHM6Ly9mb3J1bXMuZnJlZWJzZC5vcmcv">FreeBSD Forums<i class="fa fa-external-link-alt"></i></span> 找到解答，或者提出问题。</li></ul></li><li><span class="exturl" data-url="aHR0cHM6Ly9teS5vc2NoaW5hLm5ldC9xaWhoL2Jsb2cvNzg3NDM=">FreeBSD的现状和未来<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3RvcGljLzE5NTU5MjM3L2hvdA==">FreeBSD 知乎话题<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly90aWViYS5iYWlkdS5jb20vZj9rdz1mcmVlYnNkJmllPXV0Zi04">FreeBSD 吧<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cudjJleC5jb20vZ28vZnJlZWJzZA==">FreeBSD v2ex 主题<i class="fa fa-external-link-alt"></i></span></li></ul><h3 id="Xorg-Configuration"><a href="#Xorg-Configuration" class="headerlink" title="Xorg Configuration"></a>Xorg Configuration</h3><p>顯示卡、顯示器以及輸入裝置會自動偵測，無須任何手動設置。除非自動設置失敗，否則請勿建立 xorg.conf 或執行 -configure 步驟。</p><p>加入要執行 Xorg 的使用者到 <code>video</code> 或 <code>wheel</code> 群組，以便在可用時能開啟 3D 加速。要加入使用者 <em><code>jru</code></em> 到任一個可用的群組：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># pw groupmod video -m jru || pw groupmod wheel -m jru</span><br></pre></td></tr></table></figure><p>較舊版的 FreeBSD 使用的 sc 並不知到 KMS 系統的存在，這會導致關閉 X 之後即始仍在運作但系統 Console 卻呈現空白。較新版的 vt Console 可避免這個問題。</p><p>加入此行到 <code>/boot/loader.conf</code> 來開啟 vt：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kern.vty&#x3D;vt</span><br></pre></td></tr></table></figure><p>使用多檔，每一個檔案只設定一個指定項目會較傳統使用單一 <code>/etc/X11/xorg.conf</code> 設定來的簡單。完整路徑為 <code>/usr/local/etc/X11/xorg.conf.d/</code>。</p><h5 id="在檔案中設定影像驅動程式"><a href="#在檔案中設定影像驅動程式" class="headerlink" title="在檔案中設定影像驅動程式"></a>在檔案中設定影像驅動程式</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># vi &#x2F;usr&#x2F;local&#x2F;etc&#x2F;X11&#x2F;xorg.conf.d&#x2F;driver-intel.conf</span><br><span class="line">Section &quot;Device&quot;</span><br><span class="line">Identifier &quot;Card0&quot;</span><br><span class="line">Driver     &quot;intel&quot;</span><br><span class="line"># BusID    &quot;PCI:1:0:0&quot;</span><br><span class="line">EndSection</span><br></pre></td></tr></table></figure><p>若有多張顯示卡，可取消註解 <code>BusID</code> identifier 然後設定為想要的顯示卡，顯示卡的 Bus ID 清單可以使用 <code>pciconf -lv | grep -B3 display</code> 取得。</p><h5 id="手動設定"><a href="#手動設定" class="headerlink" title="手動設定"></a>手動設定</h5><p>設定檔可由 Xorg 根據偵測到的硬體產生，這個檔案對一開始自訂設定很有幫助。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># Xorg -configure</span><br></pre></td></tr></table></figure><p>設定檔會儲存至 <code>/root/xorg.conf.new</code>，做任何需要的更改，然後使用以下指令測試該檔案：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># Xorg -config &#x2F;root&#x2F;xorg.conf.new</span><br></pre></td></tr></table></figure><p>在新設定檔調整與測試過後，便可分開成較小的檔案放置到正常的位置 <code>/usr/local/etc/X11/xorg.conf.d/</code>。</p><h3 id="Install-Desktop-Enviroment"><a href="#Install-Desktop-Enviroment" class="headerlink" title="Install Desktop Enviroment"></a>Install Desktop Enviroment</h3><ul><li><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZ2hvc3Ric2Qub3JnLw==">GhostBSD<i class="fa fa-external-link-alt"></i></span> 是 FreeBSD 桌面发行版，注意使用 Official 版本，不能直接使用 FreeBSD 源升级。</p></li><li><p><span class="exturl" data-url="aHR0cHM6Ly9ub21hZGJzZC5vcmcv">nomadbsd<i class="fa fa-external-link-alt"></i></span> 是个非常漂亮的 FreeBSD 桌面发行版 ，德国产。</p></li><li><p>可以在虚拟机里面安装 FreeBSD 桌面发行版，然后找到自己想用的桌面工具，再定制自己的 FreeBSD 桌面。</p></li></ul><p>X 最初設計是以網路為中心，採用 “client-server” 架構。在此架構下 “X 伺服器” 在有鍵盤、螢幕、滑鼠的電腦上運作。該伺服器負責的工作包含管理顯示、處理來自鍵盤、滑鼠的輸入及來自其他設備)的輸入或輸出。</p><p>每個 X 應用程式，如 XTerm、Firefox 都是 “客戶端”。</p><p>視窗管理程式規定螢幕上的視窗該長什麼樣、要如何移動滑鼠指標、 要用什麼鍵來在視窗切換、每個視窗的標題列長相，及是否該有關閉按鈕，等等。視窗管理程式負責滑鼠指標的聚焦政策。 聚焦政策指的是如何決定使用中及接收鍵盤輸入的視窗。通常較為人熟悉的聚焦政策叫做 “click-to-focus”，這個模式中，滑鼠點選到的視窗便會處於作用中 (Active) 的狀態。</p><p>KDE 與 GNOME 會被稱作桌面環境是因為包含了完整常用桌面作業的應用程式。</p><ul><li><p>Install X Window System</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pkg install xorg</span><br></pre></td></tr></table></figure></li><li><p>Install Desktop Environment</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pkg install gnome3</span><br><span class="line">$ sudo pkg install gnome3-lite</span><br><span class="line">$ sudo pkg install x11&#x2F;kde5</span><br><span class="line">$ sudo pkg install xfce</span><br><span class="line">$ sudo pkg install mate</span><br></pre></td></tr></table></figure></li><li><p>Install/Enable Display Manager</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pkg install xdm</span><br><span class="line">$ sudo pkg install slim# xfce,mate</span><br><span class="line">$ sudo pkg install x11&#x2F;sddm# kde</span><br></pre></td></tr></table></figure></li><li><p>Setting</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi &#x2F;etc&#x2F;ttys</span><br><span class="line">ttyv8   &quot;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;xdm -nodaemon&quot;  xterm  on secure</span><br><span class="line"></span><br><span class="line">$ sudo vi &#x2F;etc&#x2F;fstab gnome, kde</span><br><span class="line">proc           &#x2F;proc       procfs  rw  0   0</span><br><span class="line"></span><br><span class="line">$ sudo vi &#x2F;etc&#x2F;rc.conf</span><br><span class="line">moused_enalbe&#x3D;&quot;YES&quot;</span><br><span class="line">dbus_enable&#x3D;&quot;YES&quot;# gnome, kde, xfce</span><br><span class="line">hald_enable&#x3D;&quot;YES&quot;# gnome, kde, mate</span><br><span class="line">gdm_enalbe&#x3D;&quot;YES&quot;# gnome启动</span><br><span class="line">sddm_enable&#x3D;&quot;YES&quot;# kde启动</span><br><span class="line">slim_enable&#x3D;&quot;YES&quot;# xfce,mate</span><br><span class="line">gnome_enable&#x3D;&quot;YES&quot;# gnome服务</span><br></pre></td></tr></table></figure></li><li><p>slim Usage:failed to execute login command</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi ~&#x2F;.xinitrc</span><br><span class="line">exec mate-session# mate</span><br><span class="line">exec xfce4-session# xfce</span><br></pre></td></tr></table></figure></li></ul><h3 id="Binary-套件"><a href="#Binary-套件" class="headerlink" title="Binary 套件"></a>Binary 套件</h3><p>搜寻软件：<span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZWJzZC5vcmcvcG9ydHMvaW5kZXguaHRtbA==">FreeBSD Ports<i class="fa fa-external-link-alt"></i></span>、<span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlc2hwb3J0cy5vcmcv">FreshPorts<i class="fa fa-external-link-alt"></i></span></p><p>因編譯選項不同，有些 Port 會有多個版本可使用。</p><ul><li><p><span class="exturl" data-url="aHR0cHM6Ly9taXJyb3JzLnVzdGMuZWR1LmNuL2hlbHAvZnJlZWJzZC1wa2cuaHRtbA==">USTC Mirrors<i class="fa fa-external-link-alt"></i></span>：注意使用 Latest 源，有很多流行软件。创建 <code>/usr/local/etc/pkg/repos/FreeBSD.conf</code> 覆盖官方源 <code>/etc/pkg/FreeBSD.conf</code> 配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi &#x2F;usr&#x2F;local&#x2F;etc&#x2F;pkg&#x2F;repos&#x2F;FreeBSD.conf</span><br><span class="line">FreeBSD: &#123;</span><br><span class="line">  url: &quot;pkg+http:&#x2F;&#x2F;mirrors.ustc.edu.cn&#x2F;freebsd-pkg&#x2F;$&#123;ABI&#125;&#x2F;latest&quot;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ sudo pkg update -f# 更新索引</span><br></pre></td></tr></table></figure></li><li><p><span class="exturl" data-url="aHR0cDovL21pcnJvcnMuMTYzLmNvbS9mcmVlYnNkLXBrZy9GcmVlQlNEJTNhMTIlM2FhbWQ2NC9sYXRlc3Qv">163 Mirrors<i class="fa fa-external-link-alt"></i></span></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url: &quot;pkg+http:&#x2F;&#x2F;mirrors.163.com&#x2F;freebsd-pkg&#x2F;$&#123;ABI&#125;&#x2F;latest&quot;,</span><br></pre></td></tr></table></figure></li><li><p>要啟動 (Bootstrap) 系統，請執行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo &#x2F;usr&#x2F;sbin&#x2F;pkg</span><br></pre></td></tr></table></figure></li><li><p>當升級原使用舊版 pkg_* 工具的既有系統時，必須將資料庫轉換成新的格式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pkg2ng</span><br></pre></td></tr></table></figure></li><li><p>Update the available remote repositories as listed in pkg.conf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pkg update</span><br></pre></td></tr></table></figure></li><li><p>Search for a package</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pkg search perl</span><br></pre></td></tr></table></figure></li><li><p>在指定要安裝的套件時，最好使用 Port 來源來指定該應用程式，Port 來源是指應用程式在 Port 樹中的路徑</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pkg search -o perl</span><br></pre></td></tr></table></figure></li><li><p>Install a package: Installing must specify a unique origin or version otherwise it will try installing all matches</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pkg install perl-5.14</span><br></pre></td></tr></table></figure></li><li><p>列出已經安裝的 Port 中有那些已過時</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pkg version -l &quot;&lt;&quot;</span><br></pre></td></tr></table></figure></li><li><p>Upgrade from remote repository</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pkg upgrade</span><br></pre></td></tr></table></figure></li><li><p>Delete an installed package</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pkg delete perl-5.14</span><br></pre></td></tr></table></figure></li><li><p>Remove unneeded dependencies</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pkg autoremove</span><br></pre></td></tr></table></figure></li><li><p>List installed packages</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pkg info</span><br></pre></td></tr></table></figure></li><li><p>Display information about installed packages</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pkg info perl-5.14</span><br></pre></td></tr></table></figure></li><li><p>Show the pkg-message of a package</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pkg info -D perl-5.14</span><br></pre></td></tr></table></figure></li><li><p>要查詢已安在系統上的軟體是否有任何已知的漏洞</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pkg audit -F</span><br></pre></td></tr></table></figure></li><li><p>因為相依所安裝的套件稱作自動 (Automatic) 套件，而非自動套件即套件被安裝的原因不是因為其他套件所相依</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pkg prime-list# deprecated</span><br></pre></td></tr></table></figure></li><li><p>Clean the local cache of fetched remote packages</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pkg clean</span><br></pre></td></tr></table></figure></li><li><p>Example</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pkg install node npm</span><br></pre></td></tr></table></figure></li></ul><h3 id="Port-套件"><a href="#Port-套件" class="headerlink" title="Port 套件"></a>Port 套件</h3><p>優點：</p><ul><li>可更改編譯選項</li><li>部份軟體的授權條款中禁止以 Binary 格式發佈。 這種軟體必須以原始碼發佈並由終端使用者編譯。</li><li>原始碼可套用自訂的修補。</li></ul><p>Port 中並不含實際的原始碼，在編譯 Port 解壓縮時會自動下載的原始碼到 <code>/usr/ports/distfiles</code>。</p><ul><li><p><span class="exturl" data-url="aHR0cHM6Ly9taXJyb3JzLnVzdGMuZWR1LmNuL2hlbHAvZnJlZWJzZC1wb3J0cy5odG1s">USTC Mirrors<i class="fa fa-external-link-alt"></i></span>：在 <code>/etc/make.conf</code> 中添加以下内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MASTER_SITE_OVERRIDE?&#x3D;http:&#x2F;&#x2F;mirrors.ustc.edu.cn&#x2F;freebsd-ports&#x2F;distfiles&#x2F;$&#123;DIST_SUBDIR&#125;&#x2F;</span><br></pre></td></tr></table></figure></li><li><p><span class="exturl" data-url="aHR0cDovL21pcnJvcnMuMTYzLmNvbS9mcmVlYnNkLXBvcnRzL2Rpc3RmaWxlcy8=">163 Mirrors<i class="fa fa-external-link-alt"></i></span></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MASTER_SITE_OVERRIDE?&#x3D;http:&#x2F;&#x2F;mirrors.163.com&#x2F;freebsd-ports&#x2F;distfiles&#x2F;$&#123;DIST_SUBDIR&#125;&#x2F;</span><br></pre></td></tr></table></figure></li><li><p>安裝 Port 套件集：下載壓縮後的 Port 套件集快照 (Snapshot) 到 /var/db/portsnap</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo portsnap fetch</span><br></pre></td></tr></table></figure></li><li><p>第一次執行 Portsnap 時，要先解壓縮快照到 /usr/ports</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo portsnap extract</span><br></pre></td></tr></table></figure></li><li><p>執行以下指令來更新 /usr/ports</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo portsnap fetch</span><br><span class="line">$ sudo portsnap update</span><br></pre></td></tr></table></figure></li><li><p>要找到 Port 所在的分類</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo whereis lsof</span><br></pre></td></tr></table></figure></li><li><p>使用 Port 套件集內建的搜尋機制來找軟體</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo cd &#x2F;usr&#x2F;ports</span><br><span class="line">$ sudo make search name&#x3D;lsof</span><br><span class="line">$ sudo make quicksearch name&#x3D;lsof# 不接受多資訊</span><br></pre></td></tr></table></figure></li><li><p>若要進行更有深度的搜尋</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo make search key&#x3D;string</span><br><span class="line">$ sudo make quicksearch key&#x3D;string</span><br></pre></td></tr></table></figure></li><li><p>一次設定所有Port 編譯選項</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo make config-recursive</span><br></pre></td></tr></table></figure></li><li><p>重新進入 Port 的編譯選項清單</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo make config# or</span><br><span class="line">$ sudo make showconfig# or</span><br><span class="line">$ sudo make rmconfig</span><br></pre></td></tr></table></figure></li><li><p>編譯並安裝 Port</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo cd &#x2F;usr&#x2F;ports&#x2F;sysutils&#x2F;lsof</span><br><span class="line">$ sudo make install</span><br></pre></td></tr></table></figure></li><li><p>編譯在 /usr/ports Port 並安裝到 /usr/home/example/local</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo make WRKDIRPREFIX&#x3D;..&#x2F;ports PREFIX&#x3D;..&#x2F;local install</span><br></pre></td></tr></table></figure></li><li><p>安裝過程中會建立工作用的子目錄用來儲存編譯時暫存的檔案。可移除此目錄來節省磁碟空間並漸少往後升級新版 Port 時造成問題</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo make clean</span><br></pre></td></tr></table></figure></li><li><p>移除已安裝的 Port</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo cd &#x2F;usr&#x2F;ports&#x2F;sysutils&#x2F;lsof</span><br><span class="line">$ sudo make deinstall</span><br></pre></td></tr></table></figure></li></ul><p>安裝後的注意事項：</p><ul><li>大部份應用程式安裝會在 <code>/usr/local/etc</code> 安裝至少一個預設的設定檔。</li><li>應用程式提供的文件會安裝到 <code>/usr/local/share/doc</code>。</li><li>部份應用程式會以服務的方式執行，在啟動應用程式前前需要加入設定到 <code>/etc/rc.conf</code>。這些應用程式通常會安裝啟動 Script 到 <code>/usr/local/etc/rc.d</code>。</li></ul><h3 id="Linux®-Binary-相容性"><a href="#Linux®-Binary-相容性" class="headerlink" title="Linux® Binary 相容性"></a>Linux® Binary 相容性</h3><p>FreeBSD 提供 Linux® Binary 的相容性，允許使用者在 FreeBSD 系統上不需要修改就可以安裝和執行大部份的 Linux® Binary。</p><p>最好不要直接安装 Linux 的软件，而使用 FreeBSD 源中的 Linux 软件，一般以 <code>linux-package</code> 命名。</p><ul><li><p>載入 Linux® 核心模組</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo kldload linux</span><br></pre></td></tr></table></figure></li><li><p>對 64-位元的相容性</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo kldload linux64</span><br></pre></td></tr></table></figure></li><li><p>確認模組已載入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo kldstat</span><br></pre></td></tr></table></figure></li><li><p>安裝基本的 Linux® 程式庫和 Binary</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pkg install emulators&#x2F;linux_base-c7</span><br></pre></td></tr></table></figure></li><li><p>Add the following line</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi &#x2F;etc&#x2F;fstab</span><br><span class="line">linprocfs   &#x2F;compat&#x2F;linux&#x2F;proclinprocfsrw00</span><br><span class="line">linsysfs    &#x2F;compat&#x2F;linux&#x2F;syslinsysfsrw00</span><br><span class="line">tmpfs    &#x2F;compat&#x2F;linux&#x2F;dev&#x2F;shmtmpfsrw,mode&#x3D;177700</span><br></pre></td></tr></table></figure></li><li><p>開機時開啟 Linux® 相容性</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi &#x2F;etc&#x2F;rc.conf</span><br><span class="line">linux_enable&#x3D;&quot;YES&quot;</span><br></pre></td></tr></table></figure></li><li><p>安裝 Linux® ELF Binary</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo brandelf -t Linux my-linux-elf-binary</span><br></pre></td></tr></table></figure></li><li><p>安裝以 Linux® RPM 為基礎的應用程式,需先安裝 archivers/rpm4 套件或 Port</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pkg install rpm4</span><br><span class="line">$ sudo cd &#x2F;compat&#x2F;linux</span><br><span class="line">$ sudo rpm2cpio &lt; &#x2F;path&#x2F;to&#x2F;linux.archive.rpm | cpio -id</span><br></pre></td></tr></table></figure></li><li><p>Example</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pkg install linux-sublime3-3.2.2</span><br></pre></td></tr></table></figure></li></ul><h5 id="手動安裝其他程式庫"><a href="#手動安裝其他程式庫" class="headerlink" title="手動安裝其他程式庫"></a>手動安裝其他程式庫</h5><ul><li><p>在 Linux® 系統，可使用 ldd 來找出應用程式需要哪個共用程式庫</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">% ldd linuxdoom</span><br><span class="line">libXt.so.3 (DLL Jump 3.1) &#x3D;&gt; &#x2F;usr&#x2F;X11&#x2F;lib&#x2F;libXt.so.3.1.0</span><br></pre></td></tr></table></figure></li><li><p>複製 Linux® 系統輸出結果中最後一欄需要的的檔案到 FreeBSD 系統的 /compat/linux。 複製完後，建立符號連結 (Symbolic link) 至輸出結果第一欄的名稱</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;compat&#x2F;linux&#x2F;usr&#x2F;X11&#x2F;lib&#x2F;libXt.so.3.1.0</span><br><span class="line">&#x2F;compat&#x2F;linux&#x2F;usr&#x2F;X11&#x2F;lib&#x2F;libXt.so.3 -&gt; libXt.so.3.1.0</span><br></pre></td></tr></table></figure></li></ul><h3 id="自訂核心"><a href="#自訂核心" class="headerlink" title="自訂核心"></a>自訂核心</h3><h5 id="為何要編譯自訂的核心"><a href="#為何要編譯自訂的核心" class="headerlink" title="為何要編譯自訂的核心?"></a>為何要編譯自訂的核心?</h5><p> 自訂核心有許多項優點，如：</p><ul><li>加速開機，因為自訂的核心只需要偵測您系統上存在的硬體，所以讓啟動所花的過程更流暢快速。</li><li>減少記憶體使用，自訂的核心通常會比 <code>GENERIC</code> 核心使用更少的記憶體，這很重要，因為核心必須一直存放在實體記憶體內。</li><li>支援額外的硬體，自訂的核心可以增加一些 <code>GENERIC</code> 核心沒有提供的硬體支援。</li></ul><h5 id="偵測系統硬體"><a href="#偵測系統硬體" class="headerlink" title="偵測系統硬體"></a>偵測系統硬體</h5><ul><li><p> <code>dmesg</code>  or <code>/var/run/dmesg.boot</code> </p></li><li><p><code>pciconf -lv</code></p></li><li><p>在 man指令加上 -k 旗標可列出有包含指定裝置品牌或名稱的手冊頁面清單：<code>man -k Intel</code></p></li></ul><h5 id="設定檔"><a href="#設定檔" class="headerlink" title="設定檔"></a>設定檔</h5><p><code>/usr/src/sys</code> 下子目錄代表著支援的硬體架構 (Architecture)，每個支援的硬體架構中會有 <code>conf</code> 子目錄，裡面含有供該架構使用的 <code>GENERIC</code> 核心設定檔。</p><p>說明在<code>GENERIC</code> 同目錄的 <code>NOTES</code> 檔案中。所有架構通用選項，參考 <code>/usr/src/sys/conf/NOTES</code>。</p><h3 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h3><h5 id="Screen-resolution-on-FreeBSD-on-VirtualBox"><a href="#Screen-resolution-on-FreeBSD-on-VirtualBox" class="headerlink" title="Screen resolution on FreeBSD on VirtualBox"></a>Screen resolution on FreeBSD on VirtualBox</h5><p>问题描述：在virtualbox虚拟机下，无法改变桌面分辨率为1366x768</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ VBoxManage setextradata &quot;FreeBSD&quot; VBoxInternal2&#x2F;EfiGraphicsResolution 1366x768</span><br></pre></td></tr></table></figure><h5 id="Disable-the-Forward-Back-buttons-on-my-mouse"><a href="#Disable-the-Forward-Back-buttons-on-my-mouse" class="headerlink" title="Disable the Forward/Back buttons on my mouse"></a>Disable the Forward/Back buttons on my mouse</h5><p>问题描述：浏览网页时，鼠标滑轮滚动浏览器就会前进后退。</p><p><span class="exturl" data-url="aHR0cHM6Ly91bml4LnN0YWNrZXhjaGFuZ2UuY29tL3F1ZXN0aW9ucy8yMDU1MC9ob3ctdG8tZGlzYWJsZS10aGUtZm9yd2FyZC1iYWNrLWJ1dHRvbnMtb24tbXktbW91c2U=">Salved<i class="fa fa-external-link-alt"></i></span>：</p><ul><li><p>执行下面命令后，上下滑动鼠标滑轮，看看映射到那些button，一般是buttons 8 and 9</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo xev | grep -A2 ButtonPress</span><br></pre></td></tr></table></figure></li><li><p>then disable button 8 and 9（前提是有上面的问题，否则就不要禁）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi ~&#x2F;.Xmodmap</span><br><span class="line">pointer &#x3D; 1 2 3 4 5 6 7 0 0 0 0 0</span><br></pre></td></tr></table></figure></li><li><p>test it with the command,command automatically when you log in; if yours doesn’t, arrange for it to run when X starts.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo xmodmap ~&#x2F;.Xmodmap</span><br></pre></td></tr></table></figure></li></ul><h5 id="Install-chinese-font"><a href="#Install-chinese-font" class="headerlink" title="Install chinese font"></a>Install chinese font</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pkg search cjk# CJK（中日韩统一表意文字）</span><br></pre></td></tr></table></figure><h5 id="设单使用模式为不安全"><a href="#设单使用模式为不安全" class="headerlink" title="设单使用模式为不安全"></a>设单使用模式为不安全</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi &#x2F;etc&#x2F;ttys</span><br><span class="line">console noneunknown off insecure</span><br></pre></td></tr></table></figure><h5 id="No-space-left-on-device"><a href="#No-space-left-on-device" class="headerlink" title="No space left on device"></a>No space left on device</h5><p>问题描述：使用 pkg update 时提示这个问题。原因是 /tmp is too small。</p><p><span class="exturl" data-url="aHR0cHM6Ly9mb3J1bXMuZnJlZWJzZC5vcmcvdGhyZWFkcy9uby1zcGFjZS1sZWZ0LW9uLWRldmljZS42MTIzMi8=">Salved<i class="fa fa-external-link-alt"></i></span>: </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi &#x2F;etc&#x2F;fstab</span><br><span class="line">tmpfs&#x2F;tmptmpfsrw,size&#x3D;25600000000# size 以Byte为单位</span><br></pre></td></tr></table></figure><h5 id="VirtualBox™-guest-additions"><a href="#VirtualBox™-guest-additions" class="headerlink" title="VirtualBox™ guest additions"></a>VirtualBox™ guest additions</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo cd &#x2F;usr&#x2F;ports&#x2F;emulators&#x2F;virtualbox-ose-additions &amp;&amp; make install clean</span><br><span class="line"></span><br><span class="line">$ sudo vi &#x2F;etc&#x2F;rc.conf</span><br><span class="line">vboxguest_enable&#x3D;&quot;YES&quot;</span><br><span class="line">vboxservice_enable&#x3D;&quot;YES&quot;</span><br><span class="line">vboxservice_flags&#x3D;&quot;--disable-timesync&quot;# 若有使用 ntpd或 ntpdate，便可關閉主機時間同步功能</span><br></pre></td></tr></table></figure><h5 id="Fish"><a href="#Fish" class="headerlink" title="Fish"></a>Fish</h5><p>Fish 是”the <strong>f</strong>riendly <strong>i</strong>nteractive <strong>sh</strong>ell”的简称，最大特点就是方便易用。</p><p>Fish 会自动在光标后面给出建议，表示可能的选项，颜色为灰色。如果采纳建议，可以按下<code>→</code>或<code>Control + F</code>。如果只采纳一部分，可以按下<code>Alt + →</code>。</p><p>输入命令时，Fish 会自动显示匹配的上一条历史记录。如果没有匹配的历史记录，Fish 会猜测可能的结果，自动补全各种输入。</p><h5 id="How-to-start-things-at-boot-time"><a href="#How-to-start-things-at-boot-time" class="headerlink" title="How to start things at boot time"></a><span class="exturl" data-url="aHR0cDovL3d3dy5mcmVlYnNkZGlhcnkub3JnLw==">How to start things at boot time<i class="fa fa-external-link-alt"></i></span></h5><ul><li><p>These directories are defined in <code>/etc/defaults/rc.conf</code>（主要是运行脚本）</p><ul><li><p>Default startup directory is <code>/usr/local/etc/rc.d/</code>. if you need the files to be executed in a specific order, try numbering the files. For example:</p><blockquote><p>000This.Will.Run.First.sh<br>020This.Will.Run.Next.sh<br>030And.Then.This.sh</p></blockquote></li><li><p>deprecated: <code>/etc/rc.local</code>        </p></li></ul></li></ul><ul><li><p>: DSBAutostart is a Qt program that allows you to add commands to be executed at session start.</p><p>（本质就是在 <code>.xinitrc</code> 调用程序指令，GUI 程序开机启动都需放入 <code>.xinitrc</code>，在 Xorg 启动后运行）</p><ul><li><p>Installation</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># cd &#x2F;usr&#x2F;ports&#x2F;x11&#x2F;dsbautostart &amp;&amp; make install distclean</span><br></pre></td></tr></table></figure></li><li><p>Usage</p><ul><li><p>Manual</p><pre><code>- Setup: Add the following command to your `~/.xinitrc`, or to your window manager&#39;s startup script (e.g. ~/.config/openbox/autostart.sh)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh ~&#x2F;.config&#x2F;DSB&#x2F;autostart.sh&amp;</span><br></pre></td></tr></table></figure>- `~/.config/DSB/autostart.sh`  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plank&amp;</span><br></pre></td></tr></table></figure></code></pre><ul><li>GUI: <code>Setting -&gt; DSBAutostart -&gt; Add Command</code>, example <code>plank</code>, then <code>Save</code> and <code>Quit</code></li></ul></li></ul></li></ul></li></ul><h3 id="BSDs"><a href="#BSDs" class="headerlink" title="BSDs"></a>BSDs</h3><p>NetBSD: <span class="exturl" data-url="aHR0cHM6Ly9taXJyb3JzLmh1YXdlaWNsb3VkLmNvbS9OZXRCU0Qv">huaweicloud<i class="fa fa-external-link-alt"></i></span>、<span class="exturl" data-url="aHR0cHM6Ly9taXJyb3JzLmFsaXl1bi5jb20vbmV0YnNkLz9zcG09YTJjNmguMTM2NTExMDQuMC4wLjRkODQzYmY0QXpKWVRY">aliyun<i class="fa fa-external-link-alt"></i></span>、<span class="exturl" data-url="aHR0cHM6Ly9taXJyb3JzLnR1bmEudHNpbmdodWEuZWR1LmNuLw==">tsinghua<i class="fa fa-external-link-alt"></i></span></p><p>OpenBSD: <span class="exturl" data-url="aHR0cHM6Ly9taXJyb3JzLmh1YXdlaWNsb3VkLmNvbS9PcGVuQlNELw==">huaweicloud<i class="fa fa-external-link-alt"></i></span>、<span class="exturl" data-url="aHR0cHM6Ly9taXJyb3JzLmFsaXl1bi5jb20vb3BlbmJzZC8/c3BtPWEyYzZoLjEzNjUxMTA0LjAuMC4xNGRiNWE1MHFGblhsNg==">aliyun<i class="fa fa-external-link-alt"></i></span>、<span class="exturl" data-url="aHR0cHM6Ly9taXJyb3JzLnR1bmEudHNpbmdodWEuZWR1LmNuLw==">tsinghua<i class="fa fa-external-link-alt"></i></span></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;&lt;p&gt;FreeBSD 計劃的目標在於提供可作任意用途的軟體而不附帶任何限制條文。 我們之中許多人對程式碼 (以及計畫本身) 都有非常大的投入， 因此，當然不介意偶爾有一些資金上的補償，但我們並沒打算堅決地要求得到這類資助。 我們認為我們的首要“使命”是為任何人提供程式碼， 不管他們打算用這些程式碼做什麼， 因為這樣程式碼將能夠被更廣泛地使用，從而發揮其價值。 我認為這是自由軟體最基本的，同時也是我們所倡導的一個目標。&lt;/p&gt;
&lt;p&gt;我們程式碼樹中，有若干是以 GNU 通用公共授權條款 (GPL) 或者 GNU 較寬鬆通用公共授權條款 (LGPL) 發佈的那些程式碼帶有少許的附加限制，還好只是強制性的要求開放程式碼而不是別的。 由於使用 GPL 的軟體在商業用途上會增加若干複雜性，因此，如果可以選擇的話， 我們會比較喜歡使用限制相對更寬鬆的 BSD 版權來發佈軟體。&lt;/p&gt;
&lt;footer&gt;&lt;strong&gt;Jordan Hubbard&lt;/strong&gt;&lt;cite&gt;&lt;span class=&quot;exturl&quot; data-url=&quot;aHR0cHM6Ly93d3cuZnJlZWJzZC5vcmcvZG9jL3poX1RXL2Jvb2tzL2hhbmRib29rLw==&quot;&gt;FreeBSD Handbook&lt;i class=&quot;fa fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/cite&gt;&lt;/footer&gt;&lt;/blockquote&gt;</summary>
    
    
    
    
    <category term="Unix" scheme="https://vanehsiung.github.io/tags/Unix/"/>
    
  </entry>
  
</feed>
